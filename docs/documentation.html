<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-02-02 Wed 20:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ensemble Learning</title>
<meta name="author" content="Tooraj Taraz" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<style type="text/css">
/* Base */html,body {    background-color: #222;    min-height: 100%;    line-height: 1.5;}body {    color: #fafafa;    font-family: "Courier New";}::selection {    background-color:  #2ecc40;    color: white;}/* Responsive content positioning */@media only screen and (min-width: 1020px) /* Large screens */{    body{        padding: 10vh 25vw;    }}@media only screen and (max-width: 1020px) and (min-width: 750px) /* Small screens */{    body{        padding: 5vh 10vw;    }}@media only screen and (max-width: 750px) /* Small screens */{    body{        padding: 2vh 5vw;    }}/* Headers */h1{font-size: 2.5rem;}h2{font-size: 1.7rem;}h1 > .subtitle, h3, h4, h5, h6{font-size: 1.3rem;}.title{    margin-bottom: 2.5rem;}/* Padding & Margin */* {margin: 0; padding: 0;}pre, blockquote, ul, ol, p, table{    margin: 1rem 0;}h1, h2{margin-top: 2rem; line-height: 2rem;}h3, h4, h5, h6{margin-top: 1rem;}/* Links  */a, a:visited {    color: #01ff70;    text-decoration: underline;}a:hover, a:focus, a:active {    color: #2ecc40;}/* Code */pre {    font-family: "Courier New";    padding: .5rem;    background-color: #333;    padding: 0.5rem;    border-radius: 0.2rem;    font-size: 0.9rem;    color: #EEE;    overflow-x: auto;}.org-keyword{    color: #01ff70;}.org-rainbow-delimiters-depth-1{    color: #2ecc40;}.org-rainbow-delimiters-depth-2{    color: #01ff70;}/* Blockquotes */blockquote {    border-left: 3px solid #01ff70;    padding-left: 1rem;}li{    list-style-position: inside;}/* Tags */.tag{    margin-top: 0.5rem;    display: block;    color: white;    font-size: var(--font-size-xsmall);}.tag > span{		font-weight: 400;    font-size: 0.8rem;    background-color: #444;    text-transform: uppercase;    border-radius: 2px;    width: fit-content;    height: auto;    padding: 1px 5px;}/* Keywords */.todo{    color: #2ecc40;}.done{    color: #444;}/* Overflows */.outline-text-2, .outline-text-3, .outline-text-4{	  max-width: 100%;	  overflow-x: auto;}/* Table */tr:nth-child(even) {    background-color: #333;}th, td{    padding: 0.5rem;    text-align: center;}.underline{    text-decoration: underline;}img{    max-width: 100%;    height: auto;}
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Ensemble Learning</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org898233b">1. The general idea</a></li>
<li><a href="#orgedf005b">2. How these scripts work?</a>
<ul>
<li><a href="#org7a29182">2.1. Loading data</a>
<ul>
<li><a href="#org95b595f">2.1.1. Needed modules and global variables</a></li>
<li><a href="#org711bf0d">2.1.2. Parsing the arrays in dataset</a></li>
<li><a href="#org0fdfd12">2.1.3. Extracting arrays for parsing</a></li>
<li><a href="#orga6b8696">2.1.4. Loading the dataset</a></li>
</ul>
</li>
<li><a href="#orgd280b75">2.2. Adaboosted Decision Trees</a>
<ul>
<li><a href="#org8541bce">2.2.1. Needed modules and global variables</a></li>
<li><a href="#org86288ea">2.2.2. Initializing global variables</a></li>
<li><a href="#org1cd359c">2.2.3. Initializing the meta classifier</a></li>
</ul>
</li>
<li><a href="#orga5e186e">2.3. Random Forrest</a>
<ul>
<li><a href="#orgee7338b">2.3.1. Needed modules and global variables</a></li>
<li><a href="#orgff51216">2.3.2. Initializing global variables</a></li>
<li><a href="#org081db88">2.3.3. Initializing the meta classifier</a></li>
</ul>
</li>
<li><a href="#org3d3863c">2.4. Bagged MLPs</a>
<ul>
<li><a href="#orgfe4ff2c">2.4.1. Needed modules and global variables</a></li>
<li><a href="#org11076f6">2.4.2. Initializing global variables</a></li>
<li><a href="#orgf7ebd80">2.4.3. Initializing the meta classifier</a></li>
</ul>
</li>
<li><a href="#org7397c33">2.5. Some sort of bootstraping + Soft voting</a>
<ul>
<li><a href="#orge1c281e">2.5.1. Needed modules and global variables</a></li>
<li><a href="#orgd065574">2.5.2. Initializing global variables</a></li>
<li><a href="#org0d0ef9f">2.5.3. The pipeline</a></li>
</ul>
</li>
<li><a href="#org7feaf7f">2.6. The main script</a>
<ul>
<li><a href="#org90e5cf6">2.6.1. Needed modules</a></li>
<li><a href="#org6472582">2.6.2. Loading and manuplating the data</a></li>
<li><a href="#org0cb99e7">2.6.3. Preprocessing data</a></li>
<li><a href="#orgde6b7af">2.6.4. Using what have created so far</a></li>
</ul>
</li>
<li><a href="#org10f14f8">2.7. Results</a>
<ul>
<li><a href="#orgbb31424">2.7.1. Overall view</a></li>
<li><a href="#org741a82b">2.7.2. Detailed discussion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org898233b" class="outline-2">
<h2 id="org898233b"><span class="section-number-2">1.</span> The general idea</h2>
<div class="outline-text-2" id="text-1">
<p>
The general idea behind ensemble learning is that instead of a specific algorithm for classification, we have a meta classifier that takes advantage of couple of classic classifier.
In this project we have these 4:
</p>
<ol class="org-ol">
<li>Adaboosted decision trees</li>
<li>Random forrest</li>
<li>Bagged MLPs</li>
<li>Some sort of bootstraping + Soft voting</li>
</ol>
<p>
It&rsquo;s worth mentioning that every hard coded parameter is retrieved from previous projects and tests.
</p>
</div>
</div>
<div id="outline-container-orgedf005b" class="outline-2">
<h2 id="orgedf005b"><span class="section-number-2">2.</span> How these scripts work?</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org7a29182" class="outline-3">
<h3 id="org7a29182"><span class="section-number-3">2.1.</span> Loading data</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org95b595f" class="outline-4">
<h4 id="org95b595f"><span class="section-number-4">2.1.1.</span> Needed modules and global variables</h4>
<div class="outline-text-4" id="text-2-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">from</span> os.path <span style="color: #c099ff;">import</span> exists, join
<span style="color: #c099ff;">import</span> numpy <span style="color: #c099ff;">as</span> np


<span style="color: #ff98a4;">seprator</span> = <span style="color: #c3e88d;">"\t"</span>
<span style="color: #ff98a4;">dataset_folder</span> = <span style="color: #c3e88d;">"lfw"</span>
<span style="color: #ff98a4;">train_file</span> = <span style="color: #c3e88d;">"pairsDevTrain.txt"</span>
<span style="color: #ff98a4;">test_file</span> = <span style="color: #c3e88d;">"pairsDevTest.txt"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org711bf0d" class="outline-4">
<h4 id="org711bf0d"><span class="section-number-4">2.1.2.</span> Parsing the arrays in dataset</h4>
<div class="outline-text-4" id="text-2-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">parse_array</span>(stringed_array):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">parse the stringed array</span>
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">return the array</span>
    <span style="color: #ff98a4;">result</span> = []
    <span style="color: #c099ff;">for</span> string <span style="color: #c099ff;">in</span> stringed_array:
        <span style="color: #c099ff;">if</span> <span style="color: #c3e88d;">"["</span> <span style="color: #c099ff;">in</span> string:
            <span style="color: #ff98a4;">string</span> = string[<span style="color: #ff995e; font-weight: bold;">2</span>:]
        <span style="color: #c099ff;">if</span> <span style="color: #c3e88d;">"]"</span> <span style="color: #c099ff;">in</span> string:
            <span style="color: #ff98a4;">string</span> = string[:-<span style="color: #ff995e; font-weight: bold;">2</span>]
        <span style="color: #c099ff;">for</span> token <span style="color: #c099ff;">in</span> string.split():
            result.append(<span style="color: #c099ff;">float</span>(token))
    <span style="color: #c099ff;">return</span> np.array(result)
</pre>
</div>
</div>
</div>
<div id="outline-container-org0fdfd12" class="outline-4">
<h4 id="org0fdfd12"><span class="section-number-4">2.1.3.</span> Extracting arrays for parsing</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
We need to figure out path to each txt file in dataset in order to load them as a string and then parse them and load them into memory using previous function.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">extract_array_from_line</span>(path, line):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Name _ Pic.No1 _ Pic.No2</span>
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">extract array from Pics and return them</span>
    <span style="color: #c099ff;">try</span>:
        <span style="color: #ff98a4;">name</span>, <span style="color: #ff98a4;">pic1</span>, <span style="color: #ff98a4;">pic2</span> = line.split(seprator)
        <span style="color: #ff98a4;">pic1</span> = <span style="color: #c099ff;">int</span>(pic1)
        <span style="color: #ff98a4;">pic2</span> = <span style="color: #c099ff;">int</span>(pic2)
        <span style="color: #ff98a4;">pic1</span> = f<span style="color: #c3e88d;">'{name}_{pic1:04d}.txt'</span>
        <span style="color: #ff98a4;">pic2</span> = f<span style="color: #c3e88d;">'{name}_{pic2:04d}.txt'</span>

        <span style="color: #ff98a4;">final_path</span> = join(path, name)
        <span style="color: #ff98a4;">final_pic1</span> = join(final_path, pic1)
        <span style="color: #ff98a4;">final_pic2</span> = join(final_path, pic2)
        <span style="color: #ff98a4;">parsed_pic1</span> = <span style="color: #c099ff;">open</span>(final_pic1, <span style="color: #c3e88d;">'r'</span>).readlines()
        <span style="color: #ff98a4;">parsed_pic2</span> = <span style="color: #c099ff;">open</span>(final_pic2, <span style="color: #c3e88d;">'r'</span>).readlines()


        <span style="color: #ff98a4;">parsed_pic1</span> = parse_array(parsed_pic1)
        <span style="color: #ff98a4;">parsed_pic2</span> = parse_array(parsed_pic2)
        <span style="color: #c099ff;">return</span> np.array([parsed_pic1, parsed_pic2])
    <span style="color: #c099ff;">except</span> <span style="color: #ffc777;">Exception</span>:
        <span style="color: #ff98a4;">name1</span>, <span style="color: #ff98a4;">pic1</span>, <span style="color: #ff98a4;">name2</span>, <span style="color: #ff98a4;">pic2</span> = line.split(seprator)
        <span style="color: #ff98a4;">pic1</span> = <span style="color: #c099ff;">int</span>(pic1)
        <span style="color: #ff98a4;">pic2</span> = <span style="color: #c099ff;">int</span>(pic2)
        <span style="color: #ff98a4;">pic1</span> = f<span style="color: #c3e88d;">'{name1}_{pic1:04d}.txt'</span>
        <span style="color: #ff98a4;">pic2</span> = f<span style="color: #c3e88d;">'{name2}_{pic2:04d}.txt'</span>

        <span style="color: #ff98a4;">final_path1</span> = join(path, name1)
        <span style="color: #ff98a4;">final_path2</span> = join(path, name2)

        <span style="color: #ff98a4;">final_pic1</span> = join(final_path1, pic1)
        <span style="color: #ff98a4;">final_pic2</span> = join(final_path2, pic2)

        <span style="color: #ff98a4;">parsed_pic1</span> = <span style="color: #c099ff;">open</span>(final_pic1, <span style="color: #c3e88d;">'r'</span>).readlines()
        <span style="color: #ff98a4;">parsed_pic2</span> = <span style="color: #c099ff;">open</span>(final_pic2, <span style="color: #c3e88d;">'r'</span>).readlines()


        <span style="color: #ff98a4;">parsed_pic1</span> = parse_array(parsed_pic1)
        <span style="color: #ff98a4;">parsed_pic2</span> = parse_array(parsed_pic2)
        <span style="color: #c099ff;">return</span> np.array([parsed_pic1, parsed_pic2])
</pre>
</div>
</div>
</div>
<div id="outline-container-orga6b8696" class="outline-4">
<h4 id="orga6b8696"><span class="section-number-4">2.1.4.</span> Loading the dataset</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
Now we use all the functions above to load our dataset.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">load</span>(path):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">check if the file exists</span>
    <span style="color: #7a88cf;"># </span><span style="color: #7a88cf;">if not, return None</span>
    <span style="color: #7a88cf;"># </span><span style="color: #7a88cf;">if yes, load the data</span>
    <span style="color: #7a88cf;"># </span><span style="color: #7a88cf;">return the data</span>
    <span style="color: #c099ff;">if</span> <span style="color: #c099ff;">not</span> exists(path):
        <span style="color: #c099ff;">return</span> <span style="color: #ff995e;">None</span>

    <span style="color: #ff98a4;">data_path</span> = join(path, dataset_folder)
    <span style="color: #ff98a4;">train_path</span> = join(path, train_file)
    <span style="color: #ff98a4;">test_path</span> = join(path, test_file)
    <span style="color: #ff98a4;">train_data_plus</span> = []
    <span style="color: #ff98a4;">test_data_plus</span> = []
    <span style="color: #ff98a4;">train_data_negative</span> = []
    <span style="color: #ff98a4;">test_data_negative</span> = []
    <span style="color: #ff98a4;">train_path_handle</span> = <span style="color: #c099ff;">open</span>(train_path, <span style="color: #c3e88d;">'r'</span>)
    <span style="color: #ff98a4;">test_path_handle</span> = <span style="color: #c099ff;">open</span>(test_path, <span style="color: #c3e88d;">'r'</span>)

    <span style="color: #c099ff;">for</span> i, line <span style="color: #c099ff;">in</span> <span style="color: #c099ff;">enumerate</span>(train_path_handle.readlines()):
        <span style="color: #c099ff;">if</span> i == <span style="color: #ff995e; font-weight: bold;">0</span>:
            <span style="color: #ff98a4;">count</span> = <span style="color: #c099ff;">int</span>(line)
            <span style="color: #c099ff;">continue</span>
        <span style="color: #c099ff;">if</span> i &lt;= count:
            train_data_plus.append(extract_array_from_line(data_path, line))
        <span style="color: #c099ff;">else</span>:
            train_data_negative.append(extract_array_from_line(data_path, line))

    <span style="color: #c099ff;">for</span> i, line <span style="color: #c099ff;">in</span> <span style="color: #c099ff;">enumerate</span>(test_path_handle.readlines()):
        <span style="color: #c099ff;">if</span> i == <span style="color: #ff995e; font-weight: bold;">0</span>:
            <span style="color: #ff98a4;">count</span> = <span style="color: #c099ff;">int</span>(line)
            <span style="color: #c099ff;">continue</span>
        <span style="color: #c099ff;">if</span> i &lt;= count:
            test_data_plus.append(extract_array_from_line(data_path, line))
        <span style="color: #c099ff;">else</span>:
            test_data_negative.append(extract_array_from_line(data_path, line))

    <span style="color: #c099ff;">return</span> np.array(train_data_plus), np.array(train_data_negative), np.array(test_data_plus), np.array(test_data_negative)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd280b75" class="outline-3">
<h3 id="orgd280b75"><span class="section-number-3">2.2.</span> Adaboosted Decision Trees</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Sklearn&rsquo;s implementation of all meta classifiers is used in this project.
</p>
</div>
<div id="outline-container-org8541bce" class="outline-4">
<h4 id="org8541bce"><span class="section-number-4">2.2.1.</span> Needed modules and global variables</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">from</span> sklearn.ensemble <span style="color: #c099ff;">import</span> AdaBoostClassifier
<span style="color: #c099ff;">from</span> sklearn.tree <span style="color: #c099ff;">import</span> DecisionTreeClassifier
<span style="color: #c099ff;">from</span> sklearn.metrics <span style="color: #c099ff;">import</span> accuracy_score

<span style="color: #ff98a4;">train_data</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">train_label</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">test_data</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">test_label</span> = <span style="color: #ff995e;">None</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org86288ea" class="outline-4">
<h4 id="org86288ea"><span class="section-number-4">2.2.2.</span> Initializing global variables</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
The way I&rsquo;ve modeled the data for this meta classifier, forms a vector from concatenating vector of each image, In other words imagine we have extracted parts of people&rsquo;s DNA and we want to know whether they are related or not, First we form a table containing DNA parts of each of those people&rsquo;s DNA in each row and we want our decision tree to figure out existence of any blood relationship. We are doing the samething here, each vector being image&rsquo;s DNA and their concatenation being each row. We transform the data into our desired shape and then use this function to load them.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">init_vars</span>(_train_data, _train_label, _test_data, _test_label):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Initializez global variables</span>
    <span style="color: #c099ff;">global</span> train_data
    <span style="color: #c099ff;">global</span> train_label
    <span style="color: #c099ff;">global</span> test_data
    <span style="color: #c099ff;">global</span> test_label
    <span style="color: #ff98a4;">train_data</span> = _train_data
    <span style="color: #ff98a4;">train_label</span> = _train_label
    <span style="color: #ff98a4;">test_data</span> = _test_data
    <span style="color: #ff98a4;">test_label</span> = _test_label
</pre>
</div>
</div>
</div>
<div id="outline-container-org1cd359c" class="outline-4">
<h4 id="org1cd359c"><span class="section-number-4">2.2.3.</span> Initializing the meta classifier</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
First we need to construct a decision tree classifier with our desired parameters and then passing that to our meta classifier and at the end train the meta classifier and the measure its performance. That&rsquo;s what we do for all of meta classifiers in this project.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">get_populated_dtc</span>(max_depth=<span style="color: #ff995e; font-weight: bold;">8</span>, min_samples_split=<span style="color: #ff995e; font-weight: bold;">2</span>, min_samples_leaf=<span style="color: #ff995e; font-weight: bold;">4</span>, min_impurity_decrease=<span style="color: #ff995e; font-weight: bold;">0.0</span>):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Return a DecisionTreeClassifier object</span>
    <span style="color: #ff98a4;">dtc</span> = DecisionTreeClassifier(max_depth=max_depth, min_samples_split=min_samples_split, min_samples_leaf=min_samples_leaf, min_impurity_decrease=min_impurity_decrease)
    <span style="color: #c099ff;">return</span> dtc

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">adaboosted_dt</span>():
    <span style="color: #ff98a4;">ab_dt</span> = AdaBoostClassifier(
        get_populated_dtc(), n_estimators=<span style="color: #ff995e; font-weight: bold;">100</span>
    )

    <span style="color: #c099ff;">return</span> ab_dt.fit(train_data, train_label)

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">test_accuracy</span>(trained_model):
    <span style="color: #ff98a4;">test1</span> = accuracy_score(test_label, trained_model.predict(test_data))
    <span style="color: #ff98a4;">train1</span> = accuracy_score(train_label, trained_model.predict(train_data))
    <span style="color: #c099ff;">return</span> test1, train1
</pre>
</div>
<p>
I&rsquo;ll talk about its results and performance at the end of this document.
</p>
</div>
</div>
</div>
<div id="outline-container-orga5e186e" class="outline-3">
<h3 id="orga5e186e"><span class="section-number-3">2.3.</span> Random Forrest</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-orgee7338b" class="outline-4">
<h4 id="orgee7338b"><span class="section-number-4">2.3.1.</span> Needed modules and global variables</h4>
<div class="outline-text-4" id="text-2-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">from</span> sklearn.ensemble <span style="color: #c099ff;">import</span> RandomForestClassifier
<span style="color: #c099ff;">from</span> sklearn.metrics <span style="color: #c099ff;">import</span> accuracy_score
<span style="color: #c099ff;">import</span> numpy <span style="color: #c099ff;">as</span> np

<span style="color: #ff98a4;">train_data</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">train_label</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">test_data</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">test_label</span> = <span style="color: #ff995e;">None</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgff51216" class="outline-4">
<h4 id="orgff51216"><span class="section-number-4">2.3.2.</span> Initializing global variables</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
Here I&rsquo;ve experimented with a different way of modeling data, I&rsquo;ve imagined that each vector is not just an array of features but it actually represents and actual vector in a 512 dimension and their differences and their distance can mean something, So this time I create a vector of size 513 which its first 512 elements are absolute value of two vectors and its last element is their distance.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">preprocess_data</span>(d):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Calculate vector distance and absolute value of their difference</span>
    <span style="color: #ff98a4;">res1</span> = []
    <span style="color: #ff98a4;">res2</span> = []
    <span style="color: #c099ff;">for</span> data <span style="color: #c099ff;">in</span> d:
        <span style="color: #ff98a4;">res</span> = np.subtract(data[<span style="color: #ff995e; font-weight: bold;">0</span>], data[<span style="color: #ff995e; font-weight: bold;">1</span>])
        res1.append(np.<span style="color: #c099ff;">abs</span>(res))
        res2.append(np.linalg.norm(res))
    <span style="color: #ff98a4;">res</span> = [np.append(x, y) <span style="color: #c099ff;">for</span> x, y <span style="color: #c099ff;">in</span> <span style="color: #c099ff;">zip</span>(res1, res2)]
    <span style="color: #c099ff;">return</span> np.array(res)

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">init_vars</span>(_train_data, _train_label, _test_data, _test_label):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Initializez global variables</span>
    <span style="color: #c099ff;">global</span> train_data
    <span style="color: #c099ff;">global</span> train_label
    <span style="color: #c099ff;">global</span> test_data
    <span style="color: #c099ff;">global</span> test_label
    <span style="color: #ff98a4;">train_data</span> = _train_data.reshape(<span style="color: #c099ff;">len</span>(_train_data), <span style="color: #ff995e; font-weight: bold;">2</span>, -<span style="color: #ff995e; font-weight: bold;">1</span>)
    <span style="color: #ff98a4;">train_label</span> = _train_label
    <span style="color: #ff98a4;">test_data</span> = _test_data.reshape(<span style="color: #c099ff;">len</span>(_test_data), <span style="color: #ff995e; font-weight: bold;">2</span>, -<span style="color: #ff995e; font-weight: bold;">1</span>)
    <span style="color: #ff98a4;">test_label</span> = _test_label
    <span style="color: #ff98a4;">train_data</span> = preprocess_data(train_data)
    <span style="color: #ff98a4;">test_data</span> = preprocess_data(test_data)
</pre>
</div>
</div>
</div>
<div id="outline-container-org081db88" class="outline-4">
<h4 id="org081db88"><span class="section-number-4">2.3.3.</span> Initializing the meta classifier</h4>
<div class="outline-text-4" id="text-2-3-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">test_accuracy</span>(trained_model):
    <span style="color: #ff98a4;">test1</span> = accuracy_score(test_label, trained_model.predict(test_data))
    <span style="color: #ff98a4;">train1</span> = accuracy_score(train_label, trained_model.predict(train_data))
    <span style="color: #c099ff;">return</span> test1, train1

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">handle_random_forrest</span>():
    <span style="color: #ff98a4;">rfc</span> = RandomForestClassifier(max_depth=<span style="color: #ff995e; font-weight: bold;">8</span>, min_samples_split=<span style="color: #ff995e; font-weight: bold;">2</span>, min_samples_leaf=<span style="color: #ff995e; font-weight: bold;">4</span>, min_impurity_decrease=<span style="color: #ff995e; font-weight: bold;">0.0</span>)
    <span style="color: #c099ff;">return</span> rfc.fit(train_data, train_label)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3d3863c" class="outline-3">
<h3 id="org3d3863c"><span class="section-number-3">2.4.</span> Bagged MLPs</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-orgfe4ff2c" class="outline-4">
<h4 id="orgfe4ff2c"><span class="section-number-4">2.4.1.</span> Needed modules and global variables</h4>
<div class="outline-text-4" id="text-2-4-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">from</span> sklearn.ensemble <span style="color: #c099ff;">import</span> BaggingClassifier
<span style="color: #c099ff;">from</span> sklearn.neural_network <span style="color: #c099ff;">import</span> MLPClassifier
<span style="color: #c099ff;">from</span> sklearn.metrics <span style="color: #c099ff;">import</span> accuracy_score, adjusted_rand_score

<span style="color: #ff98a4;">train_data</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">train_label</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">test_data</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">test_label</span> = <span style="color: #ff995e;">None</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org11076f6" class="outline-4">
<h4 id="org11076f6"><span class="section-number-4">2.4.2.</span> Initializing global variables</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
Here I&rsquo;ve used the same modeling as what I used in Adaboosted Decision Trees.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">init_vars</span>(_train_data, _train_label, _test_data, _test_label):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Initializez global variables</span>
    <span style="color: #c099ff;">global</span> train_data
    <span style="color: #c099ff;">global</span> train_label
    <span style="color: #c099ff;">global</span> test_data
    <span style="color: #c099ff;">global</span> test_label
    <span style="color: #ff98a4;">train_data</span> = _train_data
    <span style="color: #ff98a4;">train_label</span> = _train_label
    <span style="color: #ff98a4;">test_data</span> = _test_data
    <span style="color: #ff98a4;">test_label</span> = _test_label
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf7ebd80" class="outline-4">
<h4 id="orgf7ebd80"><span class="section-number-4">2.4.3.</span> Initializing the meta classifier</h4>
<div class="outline-text-4" id="text-2-4-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">get_populated_mlpc</span>():
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Return a MLPClassifier object</span>
    <span style="color: #ff98a4;">mlpc</span> = MLPClassifier()
    mlpc.set_params(hidden_layer_sizes=(<span style="color: #ff995e; font-weight: bold;">200</span>, <span style="color: #ff995e; font-weight: bold;">80</span>, <span style="color: #ff995e; font-weight: bold;">20</span>), alpha=<span style="color: #ff995e; font-weight: bold;">0.032</span>, random_state=<span style="color: #ff995e; font-weight: bold;">1</span>, solver=<span style="color: #c3e88d;">"adam"</span>, activation=<span style="color: #c3e88d;">"relu"</span>, max_iter=<span style="color: #ff995e; font-weight: bold;">500</span>)
    <span style="color: #c099ff;">return</span> mlpc

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">bagged_mlp</span>():
    <span style="color: #ff98a4;">bg_mlpc</span> = BaggingClassifier(base_estimator= get_populated_mlpc(), n_estimators=<span style="color: #ff995e; font-weight: bold;">20</span>, random_state=<span style="color: #ff995e; font-weight: bold;">1</span>, n_jobs=<span style="color: #ff995e; font-weight: bold;">12</span>)
    <span style="color: #c099ff;">return</span> bg_mlpc.fit(train_data, train_label)

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">test_accuracy</span>(trained_model):
    <span style="color: #ff98a4;">test1</span> = accuracy_score(test_label, trained_model.predict(test_data))
    <span style="color: #ff98a4;">train1</span> = accuracy_score(train_label, trained_model.predict(train_data))
    <span style="color: #c099ff;">return</span> test1, train1
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7397c33" class="outline-3">
<h3 id="org7397c33"><span class="section-number-3">2.5.</span> Some sort of bootstraping + Soft voting</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Here I&rsquo;ve taken advantage of three different classifiers:
</p>
<ol class="org-ol">
<li>SVM</li>
<li>MLP</li>
<li>DT</li>
</ol>
<p>
I loop over them and in each iteration train them on a random subset of dataset and modify an array of weights based on their performance and at the very end I pass them to a VotingClassifier and train that meta classifier on the whole dataset.
</p>
</div>
<div id="outline-container-orge1c281e" class="outline-4">
<h4 id="orge1c281e"><span class="section-number-4">2.5.1.</span> Needed modules and global variables</h4>
<div class="outline-text-4" id="text-2-5-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">from</span> sklearn.neural_network <span style="color: #c099ff;">import</span> MLPClassifier
<span style="color: #c099ff;">from</span> sklearn.tree <span style="color: #c099ff;">import</span> DecisionTreeClassifier
<span style="color: #c099ff;">from</span> sklearn.svm <span style="color: #c099ff;">import</span> SVC
<span style="color: #c099ff;">from</span> sklearn.ensemble <span style="color: #c099ff;">import</span> VotingClassifier

<span style="color: #c099ff;">from</span> sklearn.metrics <span style="color: #c099ff;">import</span> accuracy_score
<span style="color: #c099ff;">import</span> numpy <span style="color: #c099ff;">as</span> np

<span style="color: #ff98a4;">train_data</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">train_label</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">test_data</span> = <span style="color: #ff995e;">None</span>
<span style="color: #ff98a4;">test_label</span> = <span style="color: #ff995e;">None</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd065574" class="outline-4">
<h4 id="orgd065574"><span class="section-number-4">2.5.2.</span> Initializing global variables</h4>
<div class="outline-text-4" id="text-2-5-2">
<p>
Here I&rsquo;ve used same modeling as RandomForrest.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">preprocess_data</span>(d):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Calculate vector distance and absolute value of their difference</span>
    <span style="color: #ff98a4;">res1</span> = []
    <span style="color: #ff98a4;">res2</span> = []
    <span style="color: #c099ff;">for</span> data <span style="color: #c099ff;">in</span> d:
        <span style="color: #ff98a4;">res</span> = np.subtract(data[<span style="color: #ff995e; font-weight: bold;">0</span>], data[<span style="color: #ff995e; font-weight: bold;">1</span>])
        res1.append(np.<span style="color: #c099ff;">abs</span>(res))
        res2.append(np.linalg.norm(res))
    <span style="color: #ff98a4;">res</span> = [np.append(x, y) <span style="color: #c099ff;">for</span> x, y <span style="color: #c099ff;">in</span> <span style="color: #c099ff;">zip</span>(res1, res2)]
    <span style="color: #c099ff;">return</span> np.array(res)

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">init_vars</span>(_train_data, _train_label, _test_data, _test_label):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Initializez global variables</span>
    <span style="color: #c099ff;">global</span> train_data
    <span style="color: #c099ff;">global</span> train_label
    <span style="color: #c099ff;">global</span> test_data
    <span style="color: #c099ff;">global</span> test_label
    <span style="color: #ff98a4;">train_data</span> = _train_data.reshape(<span style="color: #c099ff;">len</span>(_train_data), <span style="color: #ff995e; font-weight: bold;">2</span>, -<span style="color: #ff995e; font-weight: bold;">1</span>)
    <span style="color: #ff98a4;">train_label</span> = _train_label
    <span style="color: #ff98a4;">test_data</span> = _test_data.reshape(<span style="color: #c099ff;">len</span>(_test_data), <span style="color: #ff995e; font-weight: bold;">2</span>, -<span style="color: #ff995e; font-weight: bold;">1</span>)
    <span style="color: #ff98a4;">test_label</span> = _test_label
    <span style="color: #ff98a4;">train_data</span> = preprocess_data(train_data)
    <span style="color: #ff98a4;">test_data</span> = preprocess_data(test_data)
</pre>
</div>
</div>
</div>
<div id="outline-container-org0d0ef9f" class="outline-4">
<h4 id="org0d0ef9f"><span class="section-number-4">2.5.3.</span> The pipeline</h4>
<div class="outline-text-4" id="text-2-5-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">def</span> <span style="color: #82aaff;">get_random_samples</span>(number_of_samples=<span style="color: #ff995e; font-weight: bold;">3</span>):
    <span style="color: #7a88cf;">#</span><span style="color: #7a88cf;">Return a list of random samples from dataset</span>
    <span style="color: #ff98a4;">res</span> = []
    <span style="color: #c099ff;">for</span> _ <span style="color: #c099ff;">in</span> <span style="color: #c099ff;">range</span>(number_of_samples):
        <span style="color: #ff98a4;">indexes</span> = np.random.choice(<span style="color: #c099ff;">len</span>(train_data), size=(<span style="color: #c099ff;">int</span>(<span style="color: #c099ff;">len</span>(train_data) / number_of_samples)), replace=<span style="color: #ff995e;">False</span>)
        res.append(indexes)
    <span style="color: #c099ff;">return</span> res

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">test_accuracy_pipeline</span>(trained_model):
    <span style="color: #ff98a4;">test1</span> = accuracy_score(test_label, trained_model.predict(test_data))
    <span style="color: #c099ff;">return</span> test1

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">test_accuracy</span>(trained_model):
    <span style="color: #ff98a4;">test1</span> = accuracy_score(test_label, trained_model.predict(test_data))
    <span style="color: #ff98a4;">train1</span> = accuracy_score(train_label, trained_model.predict(train_data))
    <span style="color: #c099ff;">return</span> test1, train1

<span style="color: #c099ff;">def</span> <span style="color: #82aaff;">pipeline</span>(debug=<span style="color: #ff995e;">False</span>):
    <span style="color: #ff98a4;">svm</span> = SVC(decision_function_shape=<span style="color: #c3e88d;">"ovr"</span>, kernel=<span style="color: #c3e88d;">"rbf"</span>, probability=<span style="color: #ff995e;">True</span>)
    <span style="color: #ff98a4;">mlp</span> = MLPClassifier(hidden_layer_sizes=(<span style="color: #ff995e; font-weight: bold;">40</span>, <span style="color: #ff995e; font-weight: bold;">30</span>, <span style="color: #ff995e; font-weight: bold;">20</span>, <span style="color: #ff995e; font-weight: bold;">30</span>, <span style="color: #ff995e; font-weight: bold;">40</span>), alpha=<span style="color: #ff995e; font-weight: bold;">0.032</span>, random_state=<span style="color: #ff995e; font-weight: bold;">1</span>, solver=<span style="color: #c3e88d;">"adam"</span>, activation=<span style="color: #c3e88d;">"relu"</span>, max_iter=<span style="color: #ff995e; font-weight: bold;">500</span>)
    <span style="color: #ff98a4;">dt</span> = DecisionTreeClassifier(max_depth=<span style="color: #ff995e; font-weight: bold;">64</span>, min_samples_split=<span style="color: #ff995e; font-weight: bold;">2</span>, min_samples_leaf=<span style="color: #ff995e; font-weight: bold;">4</span>, min_impurity_decrease=<span style="color: #ff995e; font-weight: bold;">0.0</span>)
    <span style="color: #ff98a4;">weights</span> = [<span style="color: #ff995e; font-weight: bold;">1</span> / <span style="color: #ff995e; font-weight: bold;">3</span>, <span style="color: #ff995e; font-weight: bold;">1</span> / <span style="color: #ff995e; font-weight: bold;">3</span>, <span style="color: #ff995e; font-weight: bold;">1</span> / <span style="color: #ff995e; font-weight: bold;">3</span>]
    <span style="color: #ff98a4;">last_acc</span> = [<span style="color: #ff995e; font-weight: bold;">0</span>, <span style="color: #ff995e; font-weight: bold;">0</span>, <span style="color: #ff995e; font-weight: bold;">0</span>]
    <span style="color: #c099ff;">for</span> _ <span style="color: #c099ff;">in</span> <span style="color: #c099ff;">range</span>(<span style="color: #ff995e; font-weight: bold;">10</span>):
        <span style="color: #ff98a4;">samples</span> = get_random_samples()
        svm.fit(train_data[samples[<span style="color: #ff995e; font-weight: bold;">0</span>]], train_label[samples[<span style="color: #ff995e; font-weight: bold;">0</span>]])
        mlp.fit(train_data[samples[<span style="color: #ff995e; font-weight: bold;">1</span>]], train_label[samples[<span style="color: #ff995e; font-weight: bold;">1</span>]])
        dt.fit(train_data[samples[<span style="color: #ff995e; font-weight: bold;">2</span>]], train_label[samples[<span style="color: #ff995e; font-weight: bold;">2</span>]])
        <span style="color: #ff98a4;">svm_acc</span> = test_accuracy_pipeline(svm)
        <span style="color: #ff98a4;">mlp_acc</span> = test_accuracy_pipeline(mlp)
        <span style="color: #ff98a4;">dt_acc</span> = test_accuracy_pipeline(dt)
        <span style="color: #c099ff;">if</span> svm_acc &lt; last_acc[<span style="color: #ff995e; font-weight: bold;">0</span>]:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">0</span>] -= <span style="color: #ff995e; font-weight: bold;">0.05</span>
        <span style="color: #c099ff;">elif</span> mlp_acc &lt; last_acc[<span style="color: #ff995e; font-weight: bold;">1</span>]:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">1</span>] -= <span style="color: #ff995e; font-weight: bold;">0.05</span>
        <span style="color: #c099ff;">elif</span> dt_acc &lt; last_acc[<span style="color: #ff995e; font-weight: bold;">2</span>]:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">2</span>] -= <span style="color: #ff995e; font-weight: bold;">0.05</span>
        <span style="color: #c099ff;">if</span> svm_acc &gt; last_acc[<span style="color: #ff995e; font-weight: bold;">0</span>]:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">0</span>] += <span style="color: #ff995e; font-weight: bold;">0.05</span>
        <span style="color: #c099ff;">elif</span> mlp_acc &gt; last_acc[<span style="color: #ff995e; font-weight: bold;">1</span>]:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">1</span>] += <span style="color: #ff995e; font-weight: bold;">0.05</span>
        <span style="color: #c099ff;">elif</span> dt_acc &gt; last_acc[<span style="color: #ff995e; font-weight: bold;">2</span>]:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">2</span>] += <span style="color: #ff995e; font-weight: bold;">0.05</span>
        <span style="color: #ff98a4;">last_acc</span> = [svm_acc, mlp_acc, dt_acc]
        <span style="color: #c099ff;">if</span> debug:
            <span style="color: #c099ff;">print</span>(<span style="color: #c3e88d;">"**SVM: {}, MLP: {}, DT: {}**"</span>.<span style="color: #c099ff;">format</span>(svm_acc, mlp_acc, dt_acc))
        <span style="color: #ff98a4;">svm_acc</span> = svm_acc * weights[<span style="color: #ff995e; font-weight: bold;">0</span>]
        <span style="color: #ff98a4;">mlp_acc</span> = mlp_acc * weights[<span style="color: #ff995e; font-weight: bold;">1</span>]
        <span style="color: #ff98a4;">dt_acc</span> = dt_acc * weights[<span style="color: #ff995e; font-weight: bold;">2</span>]
        <span style="color: #c099ff;">if</span> debug:
            <span style="color: #c099ff;">print</span>(<span style="color: #c3e88d;">"##SVM: {}, MLP: {}, DT: {}##"</span>.<span style="color: #c099ff;">format</span>(svm_acc, mlp_acc, dt_acc))
        <span style="color: #c099ff;">if</span> svm_acc &gt; mlp_acc <span style="color: #c099ff;">and</span> svm_acc &gt; dt_acc:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">0</span>] += <span style="color: #ff995e; font-weight: bold;">0.1</span>
        <span style="color: #c099ff;">elif</span> mlp_acc &gt; svm_acc <span style="color: #c099ff;">and</span> mlp_acc &gt; dt_acc:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">1</span>] += <span style="color: #ff995e; font-weight: bold;">0.1</span>
        <span style="color: #c099ff;">elif</span> dt_acc &gt; svm_acc <span style="color: #c099ff;">and</span> dt_acc &gt; mlp_acc:
            <span style="color: #ff98a4;">weights</span>[<span style="color: #ff995e; font-weight: bold;">2</span>] += <span style="color: #ff995e; font-weight: bold;">0.1</span>


    <span style="color: #ff98a4;">vt_svm_mlp_dt</span> = VotingClassifier(estimators=[
        (<span style="color: #c3e88d;">'svm'</span>, svm), (<span style="color: #c3e88d;">'mlp'</span>, mlp), (<span style="color: #c3e88d;">'dt'</span>, dt)],
        voting=<span style="color: #c3e88d;">'soft'</span>, weights=weights, n_jobs=<span style="color: #ff995e; font-weight: bold;">12</span>)

    <span style="color: #ff98a4;">res</span> = vt_svm_mlp_dt.fit(train_data, train_label)
    <span style="color: #c099ff;">if</span> debug:
        <span style="color: #c099ff;">print</span>(<span style="color: #c3e88d;">"Final accuracy: {}"</span>.<span style="color: #c099ff;">format</span>(test_accuracy(res)[<span style="color: #ff995e; font-weight: bold;">0</span>]))
    <span style="color: #c099ff;">return</span> res
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7feaf7f" class="outline-3">
<h3 id="org7feaf7f"><span class="section-number-3">2.6.</span> The main script</h3>
<div class="outline-text-3" id="text-2-6">
</div>
<div id="outline-container-org90e5cf6" class="outline-4">
<h4 id="org90e5cf6"><span class="section-number-4">2.6.1.</span> Needed modules</h4>
<div class="outline-text-4" id="text-2-6-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #c099ff;">import</span> numpy <span style="color: #c099ff;">as</span> np
<span style="color: #c099ff;">from</span> utils.data_loader <span style="color: #c099ff;">import</span> load
<span style="color: #c099ff;">import</span> utils.ensemble_dt <span style="color: #c099ff;">as</span> edt
<span style="color: #c099ff;">import</span> utils.ensemble_bag_mlp <span style="color: #c099ff;">as</span> ebm
<span style="color: #c099ff;">import</span> utils.svm_mlp_dt_combo <span style="color: #c099ff;">as</span> smdt
<span style="color: #c099ff;">import</span> utils.ensemble_rf <span style="color: #c099ff;">as</span> erf
<span style="color: #c099ff;">from</span> sklearn <span style="color: #c099ff;">import</span> preprocessing
<span style="color: #c099ff;">from</span> tabulate <span style="color: #c099ff;">import</span> tabulate
</pre>
</div>
</div>
</div>
<div id="outline-container-org6472582" class="outline-4">
<h4 id="org6472582"><span class="section-number-4">2.6.2.</span> Loading and manuplating the data</h4>
<div class="outline-text-4" id="text-2-6-2">
<p>
Here I transform loaded data into the form I explained in AdaBoostClassifier section.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff98a4;">train_plus</span>, <span style="color: #ff98a4;">train_negative</span>, <span style="color: #ff98a4;">test_plus</span>, <span style="color: #ff98a4;">test_negative</span> = load(<span style="color: #c3e88d;">"/home/toorajtaraz/Downloads/project/"</span>)
<span style="color: #ff98a4;">train_data_count</span> = train_plus.shape[<span style="color: #ff995e; font-weight: bold;">0</span>]
<span style="color: #ff98a4;">test_data_count</span> = test_plus.shape[<span style="color: #ff995e; font-weight: bold;">0</span>]

<span style="color: #ff98a4;">train_plus</span> = train_plus.reshape((train_data_count, -<span style="color: #ff995e; font-weight: bold;">1</span>))
<span style="color: #ff98a4;">train_negative</span> = train_negative.reshape((train_data_count, -<span style="color: #ff995e; font-weight: bold;">1</span>))
<span style="color: #ff98a4;">test_plus</span> = test_plus.reshape((test_data_count, -<span style="color: #ff995e; font-weight: bold;">1</span>))
<span style="color: #ff98a4;">test_negative</span> = test_negative.reshape((test_data_count, -<span style="color: #ff995e; font-weight: bold;">1</span>))

<span style="color: #ff98a4;">train_data</span> = []
<span style="color: #ff98a4;">train_label</span> = []

<span style="color: #ff98a4;">test_data</span> = []
<span style="color: #ff98a4;">test_label</span> = []

<span style="color: #c099ff;">for</span> x <span style="color: #c099ff;">in</span> train_plus:
    train_data.append(x)
    train_label.append(<span style="color: #ff995e; font-weight: bold;">1</span>)

<span style="color: #c099ff;">for</span> x <span style="color: #c099ff;">in</span> train_negative:
    train_data.append(x)
    train_label.append(<span style="color: #ff995e; font-weight: bold;">0</span>)

<span style="color: #c099ff;">for</span> x <span style="color: #c099ff;">in</span> test_plus:
    test_data.append(x)
    test_label.append(<span style="color: #ff995e; font-weight: bold;">1</span>)

<span style="color: #c099ff;">for</span> x <span style="color: #c099ff;">in</span> test_negative:
    test_data.append(x)
    test_label.append(<span style="color: #ff995e; font-weight: bold;">0</span>)

<span style="color: #ff98a4;">test_data</span> = np.array(test_data)
<span style="color: #ff98a4;">train_data</span> = np.array(train_data)
<span style="color: #ff98a4;">test_label</span> = np.array(test_label)
<span style="color: #ff98a4;">train_label</span> = np.array(train_label)
</pre>
</div>
</div>
</div>
<div id="outline-container-org0cb99e7" class="outline-4">
<h4 id="org0cb99e7"><span class="section-number-4">2.6.3.</span> Preprocessing data</h4>
<div class="outline-text-4" id="text-2-6-3">
<p>
Sklearn Library offers a module that takes care of standardizing the data, this action improves convergence time and accuracy (at least based on what I witnessed).
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff98a4;">scaler</span> = preprocessing.StandardScaler().fit(train_data)
<span style="color: #ff98a4;">train_data</span> = scaler.transform(train_data)

<span style="color: #ff98a4;">scaler</span> = preprocessing.StandardScaler().fit(test_data)
<span style="color: #ff98a4;">test_data</span> = scaler.transform(test_data)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgde6b7af" class="outline-4">
<h4 id="orgde6b7af"><span class="section-number-4">2.6.4.</span> Using what have created so far</h4>
<div class="outline-text-4" id="text-2-6-4">
<div class="org-src-container">
<pre class="src src-python">edt.init_vars(train_data, train_label, test_data, test_label)
<span style="color: #ff98a4;">adaboosted_dt_acc</span> = edt.test_accuracy(edt.adaboosted_dt())

ebm.init_vars(train_data, train_label, test_data, test_label)
<span style="color: #ff98a4;">bagged_mlp_acc</span> = ebm.test_accuracy(ebm.bagged_mlp())

smdt.init_vars(train_data, train_label, test_data, test_label)
<span style="color: #ff98a4;">svm_mlp_dt_combo_acc</span> = smdt.test_accuracy(smdt.pipeline(debug=<span style="color: #ff995e;">True</span>))

erf.init_vars(train_data, train_label, test_data, test_label)
<span style="color: #ff98a4;">random_forrest_acc</span> = erf.test_accuracy(erf.handle_random_forrest())
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org10f14f8" class="outline-3">
<h3 id="org10f14f8"><span class="section-number-3">2.7.</span> Results</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-orgbb31424" class="outline-4">
<h4 id="orgbb31424"><span class="section-number-4">2.7.1.</span> Overall view</h4>
<div class="outline-text-4" id="text-2-7-1">
<!-- This HTML table template is generated by emacs 27.2 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      TEST_P
    </td>
    <td align="left" valign="top">
      TRAIN_P&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      AdaboostedDecisionTree
    </td>
    <td align="left" valign="top">
      0.578&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BaggedMLP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      0.766&nbsp;
    </td>
    <td align="left" valign="top">
      0.997273
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SVM_MLP_DT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      0.844&nbsp;
    </td>
    <td align="left" valign="top">
      0.963636
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RandomForest&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;0.81&nbsp;
    </td>
    <td align="left" valign="top">
      0.985909
    </td>
  </tr>
</table>
</div>
</div>
<div id="outline-container-org741a82b" class="outline-4">
<h4 id="org741a82b"><span class="section-number-4">2.7.2.</span> Detailed discussion</h4>
<div class="outline-text-4" id="text-2-7-2">
<p>
In case of AdaboostedDecisionTree, it performed as I excepted, very well on train dataset and poorly on test dataset due to over fitting.
BaggedMLPs didn&rsquo;t perform very well as excepted, just about 2000 data samples are not enough for training a MLP. At first I intended to extract data from dataset folder and train my model on a larger dataset, but I figured due to our point being related to the accuracy we achieve it wouldn&rsquo;t be ethical :))
RandomForest and my customish algorithm performed better than the others.
During my tests I concluded that SVM with RBF kernel performs the best and the ensemble final accuracy is really close to SVM&rsquo;s accuracy, but I assume it wouldn&rsquo;t be the case if we had a large enough dataset, in that case MLP would be the dominant model in voting.
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Tooraj Taraz</p>
<p class="date">Created: 2022-02-02 Wed 20:01</p>
</div>
</body>
</html>
